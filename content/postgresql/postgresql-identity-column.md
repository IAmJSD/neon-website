---
title: 'PostgreSQL Identity Column'
redirectFrom: 
            - https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-identity-column/
ogImage: ./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-OVERRIDING-SYSTEM-VALUE-example.png
tableOfContents: true
---
<!-- wp:paragraph -->

**Summary**: in this tutorial, you will learn how to use the `GENERATED AS IDENTITY` constraint to create the PostgreSQL identity column for a table.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## Introduction to PostgreSQL identity column

<!-- /wp:heading -->

<!-- wp:paragraph -->

PostgreSQL version 10 introduced a new constraint `GENERATED AS IDENTITY` that allows you to automatically assign a unique number to a column.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

The `GENERATED AS IDENTITY` constraint is the SQL standard-conforming variant of the good old `SERIAL` column.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

The following illustrates the syntax of the `GENERATED AS IDENTITY` constraint:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
column_name type
GENERATED { ALWAYS | BY DEFAULT }
AS IDENTITY[ ( sequence_option ) ]
```

<!-- /wp:code -->

<!-- wp:paragraph -->

In this syntax:

<!-- /wp:paragraph -->

<!-- wp:list -->

- <!-- wp:list-item -->
- The type can be `SMALLINT`, `INT`, or `BIGINT`.
- <!-- /wp:list-item -->
-
- <!-- wp:list-item -->
- The `GENERATED ALWAYS` instructs PostgreSQL to always generate a value for the identity column. If you attempt to insert (or update) values into the `GENERATED ALWAYS AS IDENTITY` column, PostgreSQL will issue an error.
- <!-- /wp:list-item -->
-
- <!-- wp:list-item -->
- The `GENERATED BY DEFAULT` instructs PostgreSQL to generate a value for the identity column. However, if you supply a value for insert or update, PostgreSQL will use that value to insert into the identity column instead of using the system-generated value.
- <!-- /wp:list-item -->

<!-- /wp:list -->

<!-- wp:paragraph -->

PostgreSQL allows a table to have more than one identity column. Like the `SERIAL`, the `GENERATED AS IDENTITY` constraint also uses the `SEQUENCE` object internally.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## PostgreSQL identity column examples

<!-- /wp:heading -->

<!-- wp:paragraph -->

Let's take some examples of using the PostgreSQL identity columns.

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### 1) GENERATED ALWAYS example

<!-- /wp:heading -->

<!-- wp:paragraph -->

First, [create a table](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-create-table/) named `color` with the `color_id` as the identity column:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
CREATE TABLE color (
    color_id INT GENERATED ALWAYS AS IDENTITY,
    color_name VARCHAR NOT NULL
);
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Second, insert a new row into the `color` table:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color(color_name)
VALUES ('Red');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Because `color_id` column has the `GENERATED AS IDENTITY` constraint, PostgreSQL generates a value for it as shown in the query below:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
SELECT * FROM color;
```

<!-- /wp:code -->

<!-- wp:image {"id":3529} -->

![PostgreSQL Identity Column - GENERATED AS ALWAYS example](https://www.postgresqltutorial.com/wp-content/uploads/2018/03/PostgreSQL-identity-column-generated-as-always-example.png)

<!-- /wp:image -->

<!-- wp:paragraph -->

Third, insert a new row by supplying values for both `color_id` and `color_name` columns:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_id, color_name)
VALUES (2, 'Green');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

PostgreSQL issued the following error:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
[Err] ERROR:  cannot insert into column "color_id"
DETAIL:  Column "color_id" is an identity column defined as GENERATED ALWAYS.
HINT:  Use OVERRIDING SYSTEM VALUE to override.
```

<!-- /wp:code -->

<!-- wp:paragraph -->

To fix the error, you can use the `OVERRIDING SYSTEM VALUE` clause as follows:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_id, color_name)
OVERRIDING SYSTEM VALUE
VALUES(2, 'Green');
```

<!-- /wp:code -->

<!-- wp:image {"id":3531} -->

![PostgreSQL identity column - OVERRIDING SYSTEM VALUE example](./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-OVERRIDING-SYSTEM-VALUE-example.png)

<!-- /wp:image -->

<!-- wp:paragraph -->

Alternatively, you can use `GENERATED BY DEFAULT AS IDENTITY` instead.

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### 2) GENERATED BY DEFAULT AS IDENTITY example

<!-- /wp:heading -->

<!-- wp:paragraph -->

First, [drop](https://www.postgresqltutorial.com/postgresql-tutorial/postgresql-drop-table/) the `color` table and recreate it. This time we will use the `GENERATED BY DEFAULT AS IDENTITY` instead:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
DROP TABLE color;

CREATE TABLE color (
    color_id INT GENERATED BY DEFAULT AS IDENTITY,
    color_name VARCHAR NOT NULL
);
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Second, insert a row into the `color` table:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_name)
VALUES ('White');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

It works as expected.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

Third, insert another row with a value for the `color_id` column:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_id, color_name)
VALUES (2, 'Yellow');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Unlike the previous example that uses the `GENERATED ALWAYS AS IDENTITY` constraint, the statement above works perfectly fine.

<!-- /wp:paragraph -->

<!-- wp:heading {"level":3} -->

### 3) Sequence options example

<!-- /wp:heading -->

<!-- wp:paragraph -->

Because the `GENERATED AS IDENTITY` constraint uses the `SEQUENCE` object, you can specify the sequence options for the system-generated values.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

For example, you can specify the starting value and the increment as follows:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
DROP TABLE color;

CREATE TABLE color (
    color_id INT GENERATED BY DEFAULT AS IDENTITY
    (START WITH 10 INCREMENT BY 10),
    color_name VARCHAR NOT NULL
);
```

<!-- /wp:code -->

<!-- wp:paragraph -->

In this example, the system-generated value for the `color_id` column starts with 10 and the increment value is also 10.

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

First, insert a new row into the color table:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_name)
VALUES ('Orange');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

The starting value for `color_id` column is ten as shown below:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
SELECT * FROM color;
```

<!-- /wp:code -->

<!-- wp:image {"id":3532} -->

![PostgreSQL identity column - sequence options example](./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-sequence-options-example.png)

<!-- /wp:image -->

<!-- wp:paragraph -->

Second, insert another row into the `color` table:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
INSERT INTO color (color_name)
VALUES ('Purple');
```

<!-- /wp:code -->

<!-- wp:paragraph -->

The value of the `color_id` of the second row is 20 because of the increment option.

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
SELECT * FROM color;
```

<!-- /wp:code -->

<!-- wp:image {"id":3530} -->

![PostgreSQL identity column - increment example](./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-increment-example.png)

<!-- /wp:image -->

<!-- wp:heading -->

## Adding an identity column to an existing table

<!-- /wp:heading -->

<!-- wp:paragraph -->

You can add identity columns to an existing table by using the following form of the `ALTER TABLE` statement:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE table_name
ALTER COLUMN column_name
ADD GENERATED { ALWAYS | BY DEFAULT } AS IDENTITY { ( sequence_option ) }
```

<!-- /wp:code -->

<!-- wp:paragraph -->

For example:

<!-- /wp:paragraph -->

<!-- wp:paragraph -->

First, create a new table named `shape`:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
CREATE TABLE shape (
    shape_id INT NOT NULL,
    shape_name VARCHAR NOT NULL
);
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Second, change the `shape_id` column to the identity column:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE shape
ALTER COLUMN shape_id ADD GENERATED ALWAYS AS IDENTITY;
```

<!-- /wp:code -->

<!-- wp:paragraph -->

Note that the `shape_id` needs to have the `NOT NULL` constraint so that it can be changed to an identity column. Otherwise, you'll get the following error:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"shell"} -->

```
ERROR:  column "shape_id" of relation "shape" must be declared NOT NULL before identity can be added
SQL state: 55000
```

<!-- /wp:code -->

<!-- wp:paragraph -->

The following command describes the `shape` table in psql tool:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"shell"} -->

```
\d shape
```

<!-- /wp:code -->

<!-- wp:paragraph -->

It returns the following output which is what we expected:

<!-- /wp:paragraph -->

<!-- wp:image {"id":3527} -->

![](./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-alter-column-example.png)

<!-- /wp:image -->

<!-- wp:heading -->

## Changing an identity column

<!-- /wp:heading -->

<!-- wp:paragraph -->

You can change the characteristics of an existing identity column by using the following `ALTER TABLE` statement:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE table_name
ALTER COLUMN column_name
{ SET GENERATED { ALWAYS| BY DEFAULT } |
  SET sequence_option | RESTART [ [ WITH ] restart ] }
```

<!-- /wp:code -->

<!-- wp:paragraph -->

For example, the following statement changes the `shape_id` column of the `shape` table to `GENERATED BY DEFAULT`:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE shape
ALTER COLUMN shape_id SET GENERATED BY DEFAULT;
```

<!-- /wp:code -->

<!-- wp:paragraph -->

The following command describes the structure of the shape table in the psql tool:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"shell"} -->

```
\d shape
```

<!-- /wp:code -->

<!-- wp:image {"id":3528} -->

![](./img/wp-content-uploads-2018-03-PostgreSQL-identity-column-changing-identity-column-example.png)

<!-- /wp:image -->

<!-- wp:paragraph -->

As you can see from the output, the `shape_id` column changed from `GENERATED ALWAYS` to `GENERATED BY DEFAULT`.

<!-- /wp:paragraph -->

<!-- wp:heading -->

## Removing the GENERATED AS IDENTITY constraint

<!-- /wp:heading -->

<!-- wp:paragraph -->

The following statement removes the `GENERATED AS IDENTITY` constraint from an existing table:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE table_name
ALTER COLUMN column_name
DROP IDENTITY [ IF EXISTS ]
```

<!-- /wp:code -->

<!-- wp:paragraph -->

For example, you can remove the `GENERATED AS IDENTITY` constraint column from the `shape_id` column of the `shape` table as follows:

<!-- /wp:paragraph -->

<!-- wp:code {"language":"sql"} -->

```
ALTER TABLE shape
ALTER COLUMN shape_id
DROP IDENTITY IF EXISTS;
```

<!-- /wp:code -->

<!-- wp:paragraph -->

In this tutorial, you have learned how to use the PostgreSQL identity column and how to manage it by using the `GENERATED AS IDENTITY` constraint.

<!-- /wp:paragraph -->
